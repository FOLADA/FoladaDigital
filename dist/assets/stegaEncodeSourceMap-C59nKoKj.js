import{i as t,C as e}from"./sanity-BU0_GEO5.js";import"./i18n-DirEcjym.js";import"./vendor-BrIQynLM.js";import"./ui-CAR4CKGU.js";import"./animations-DWA-uona.js";const n=/_key\s*==\s*['"](.*)['"]/;function r(t){if(!Array.isArray(t))throw new Error("Path is not an array");return t.reduce((t,e,r)=>{const o=typeof e;if("number"===o)return`${t}[${e}]`;if("string"===o)return`${t}${0===r?"":"."}${e}`;if(function(t){return"string"==typeof t?n.test(t.trim()):"object"==typeof t&&"_key"in t}(e)&&e._key)return`${t}[_key=="${e._key}"]`;if(Array.isArray(e)){const[n,r]=e;return`${t}[${n}:${r}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(e)}\``)},"")}const o={"\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","'":"\\'","\\":"\\\\"},i={"\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t","\\'":"'","\\\\":"\\"};function s(t){const e=[],n=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let r;for(;null!==(r=n.exec(t));){if(void 0!==r[1]){const t=r[1].replace(/\\(\\|f|n|r|t|')/g,t=>i[t]);e.push(t);continue}if(void 0===r[2]){if(void 0!==r[3]){const t=r[3].replace(/\\(\\')/g,t=>i[t]);e.push({_key:t,_index:-1});continue}}else e.push(parseInt(r[2],10))}return e}function a(t){return t.map(t=>{if("string"==typeof t||"number"==typeof t)return t;if(""!==t._key)return{_key:t._key};if(-1!==t._index)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})}function l(e,n,r=[]){if(function(t){return null!==t&&Array.isArray(t)}(e))return e.map((e,o)=>{if(t(e)){const t=e._key;if("string"==typeof t)return l(e,n,r.concat({_key:t,_index:o}))}return l(e,n,r.concat(o))});if(t(e)){if("block"===e._type||"span"===e._type){const t={...e};return"block"===e._type?t.children=l(e.children,n,r.concat("children")):"span"===e._type&&(t.text=l(e.text,n,r.concat("text"))),t}return Object.fromEntries(Object.entries(e).map(([t,e])=>[t,l(e,n,r.concat(t))]))}return n(e,r)}function u(t,e,n){return l(t,(t,r)=>{if("string"!=typeof t)return t;const i=function(t,e){if(!(null==e?void 0:e.mappings))return;const n=`$${t.map(t=>{if("string"==typeof t||"number"==typeof t)return t;if(-1!==t._index)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)}).map(t=>"string"==typeof t?`['${t.replace(/[\f\n\r\t'\\]/g,t=>o[t])}']`:"number"==typeof t?`[${t}]`:""!==t._key?`[?(@._key=='${t._key.replace(/['\\]/g,t=>o[t])}')]`:`[${t._index}]`).join("")}`;if(void 0!==e.mappings[n])return{mapping:e.mappings[n],matchedPath:n,pathSuffix:""};const r=Object.entries(e.mappings).filter(([t])=>n.startsWith(t)).sort(([t],[e])=>e.length-t.length);if(0==r.length)return;const[i,s]=r[0];return{mapping:s,matchedPath:i,pathSuffix:n.substring(i.length)}}(r,e);if(!i)return t;const{mapping:a,matchedPath:l}=i;if("value"!==a.type||"documentValue"!==a.source.type)return t;const u=e.documents[a.source.document],c=e.paths[a.source.path],p=s(l),f=s(c).concat(r.slice(p.length));return n({sourcePath:f,sourceDocument:u,resultPath:r,value:t})})}const c=".",p=`drafts${c}`,f=`versions${c}`;function d(t){return t.startsWith(p)}function h(t){return t.startsWith(f)}function g(t){const{baseUrl:e,workspace:n="default",tool:o="default",id:i,type:s,path:l,projectId:u,dataset:f}=t;if(!e)throw new Error("baseUrl is required");if(!l)throw new Error("path is required");if(!i)throw new Error("id is required");if("/"!==e&&e.endsWith("/"))throw new Error("baseUrl must not end with a slash");const g="default"===n?void 0:n,y="default"===o?void 0:o,m=function(t){return h(t)?t.split(c).slice(2).join(c):d(t)?t.slice(p.length):t}(i),v=Array.isArray(l)?r(a(l)):l,$=new URLSearchParams({baseUrl:e,id:m,type:s,path:v});if(g&&$.set("workspace",g),y&&$.set("tool",y),u&&$.set("projectId",u),f&&$.set("dataset",f),function(t){return!d(t)&&!h(t)}(i))$.set("perspective","published");else if(h(i)){const t=function(t){if(!h(t))return;const[e,n,...r]=t.split(c);return n}(i);$.set("perspective",t)}const w=["/"===e?"":e];g&&w.push(g);const _=["mode=presentation",`id=${m}`,`type=${s}`,`path=${encodeURIComponent(v)}`];return y&&_.push(`tool=${y}`),w.push("intent","edit",`${_.join(";")}?${$}`),w.join("/")}const y=({sourcePath:t,resultPath:e,value:n})=>{if(/^\d{4}-\d{2}-\d{2}/.test(r=n)&&Date.parse(r)||function(t){try{const{protocol:e}=new URL(t,t.startsWith("/")?"https://acme.com":void 0);return v.has(e)||e.startsWith("web+")}catch{return!1}}(n))return!1;var r;const o=t.at(-1);return!("slug"===t.at(-2)&&"current"===o||"string"==typeof o&&(o.startsWith("_")||o.endsWith("Id"))||t.some(t=>"meta"===t||"metadata"===t||"openGraph"===t||"seo"===t)||$(t)||$(e)||"string"==typeof o&&m.has(o))},m=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","textTheme","unit","url","username","variant","website"]),v=new Set(["app:","data:","discord:","file:","ftp:","ftps:","geo:","http:","https:","imap:","javascript:","magnet:","mailto:","maps:","ms-excel:","ms-powerpoint:","ms-word:","slack:","sms:","spotify:","steam:","teams:","tel:","vscode:","zoom:"]);function $(t){return t.some(t=>"string"==typeof t&&null!==t.match(/type/i))}function w(t,r,o){var i,s,a,l,c,p,f,d,h;const{filter:m,logger:v,enabled:$}=o;if(!$){const e="config.enabled must be true, don't call this function otherwise";throw null==(i=null==v?void 0:v.error)||i.call(v,`[@sanity/client]: ${e}`,{result:t,resultSourceMap:r,config:o}),new TypeError(e)}if(!r)return null==(s=null==v?void 0:v.error)||s.call(v,"[@sanity/client]: Missing Content Source Map from response body",{result:t,resultSourceMap:r,config:o}),t;if(!o.studioUrl){const e="config.studioUrl must be defined";throw null==(a=null==v?void 0:v.error)||a.call(v,`[@sanity/client]: ${e}`,{result:t,resultSourceMap:r,config:o}),new TypeError(e)}const w={encoded:[],skipped:[]},b=u(t,r,({sourcePath:t,sourceDocument:n,resultPath:r,value:i})=>{if(!1===("function"==typeof m?m({sourcePath:t,resultPath:r,filterDefault:y,sourceDocument:n,value:i}):y({sourcePath:t,resultPath:r,value:i})))return v&&w.skipped.push({path:_(t),value:`${i.slice(0,20)}${i.length>20?"...":""}`,length:i.length}),i;v&&w.encoded.push({path:_(t),value:`${i.slice(0,20)}${i.length>20?"...":""}`,length:i.length});const{baseUrl:s,workspace:a,tool:l}=function(t){let e="string"==typeof t?t:t.baseUrl;return"/"!==e&&(e=e.replace(/\/$/,"")),"string"==typeof t?{baseUrl:e}:{...t,baseUrl:e}}("function"==typeof o.studioUrl?o.studioUrl(n):o.studioUrl);if(!s)return i;const{_id:u,_type:c,_projectId:p,_dataset:f}=n;return e(i,{origin:"sanity.io",href:g({baseUrl:s,workspace:a,tool:l,id:u,type:c,path:t,...!o.omitCrossDatasetReferenceData&&{dataset:f,projectId:p}})},!1)});if(v){const t=w.skipped.length,e=w.encoded.length;if((t||e)&&(null==(l=(null==v?void 0:v.groupCollapsed)||v.log)||l("[@sanity/client]: Encoding source map into result"),null==(c=v.log)||c.call(v,`[@sanity/client]: Paths encoded: ${w.encoded.length}, skipped: ${w.skipped.length}`)),w.encoded.length>0&&(null==(p=null==v?void 0:v.log)||p.call(v,"[@sanity/client]: Table of encoded paths"),null==(f=(null==v?void 0:v.table)||v.log)||f(w.encoded)),w.skipped.length>0){const t=new Set;for(const{path:e}of w.skipped)t.add(e.replace(n,"0").replace(/\[\d+\]/g,"[]"));null==(d=null==v?void 0:v.log)||d.call(v,"[@sanity/client]: List of skipped paths",[...t.values()])}(t||e)&&(null==(h=null==v?void 0:v.groupEnd)||h.call(v))}return b}function _(t){return r(a(t))}var b=Object.freeze({__proto__:null,stegaEncodeSourceMap:w});export{u as encodeIntoResult,w as stegaEncodeSourceMap,b as stegaEncodeSourceMap$1};
